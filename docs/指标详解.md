# 目标检测指标详解

本文档详细解释了 `EasyMetrics` 平台输出的各项检测指标含义，帮助你更好地理解模型性能。所有指标均遵循 COCO 评估标准。

## 1. 平均精度 (Average Precision, AP)

AP 是目标检测中最重要的指标，它综合了**精度 (Precision)** 和 **召回率 (Recall)**。

- **Precision (查准率)**: 预测为正样本中，真正正确的比例。 $P = \frac{TP}{TP + FP}$
- **Recall (查全率)**: 所有真实正样本中，被正确预测出的比例。 $R = \frac{TP}{TP + FN}$

我们使用 **IoU (Intersection over Union)** 来判定预测框是否正确。如果 `IoU(Pred, GT) >= 阈值`，则视为 TP (True Positive)。

### 主要指标

| 指标键名 | 含义 | 详细解释 |
| :--- | :--- | :--- |
| **mAP** | **平均 AP** | **最重要的综合指标**。它是在 IoU 阈值从 0.50 到 0.95（步长 0.05）共 10 个阈值下计算出的 AP 的平均值，并且对所有类别取平均。它反映了模型在不同严格程度下的综合表现。在 COCO 竞赛中简称为 AP。 |
| **mAP_50** | IoU=0.50 的 mAP | PASCAL VOC 竞赛的标准指标。只要求 IoU > 0.5 就算正确，相对宽松。 |
| **mAP_75** | IoU=0.75 的 mAP | 严格模式下的指标。要求检测框与真值重叠度很高才算正确。 |
| **AP_<class_id>** | 特定类别的 AP | 该类别的 Average Precision (IoU 0.5:0.95)。 |
| **AP_50_<class_id>** | 特定类别的 AP@50 | 该类别在 IoU=0.50 下的 AP。 |
| **AP_75_<class_id>** | 特定类别的 AP@75 | 该类别在 IoU=0.75 下的 AP。 |

### 不同尺度的 AP

为了分析模型对不同大小物体的检测能力，我们将物体按面积（像素数）分为三类：

| 指标键名 | 含义 | 定义 (面积 = 宽 × 高) |
| :--- | :--- | :--- |
| **mAP_s** | 小目标 mAP | 面积 < $32^2$ (小于 1024 像素) |
| **mAP_m** | 中目标 mAP | $32^2 \le$ 面积 < $96^2$ (1024 ~ 9216 像素) |
| **mAP_l** | 大目标 mAP | 面积 $\ge 96^2$ (大于 9216 像素) |

通常小目标检测 (mAP_s) 是最难的。

## 2. 平均召回率 (Average Recall, AR)

AR 反映了模型发现目标的能力，不考虑分数的排序，主要关注有多少真值被覆盖了。

EasyMetrics 按照每张图片允许的最大检测数 (Max Dets) 来计算 AR：

| 指标键名 | 含义 | 详细解释 |
| :--- | :--- | :--- |
| **AR_1** | MaxDets=1 的 AR | 每张图只取置信度最高的 1 个框来计算召回率。 |
| **AR_10** | MaxDets=10 的 AR | 每张图取前 10 个框计算召回率。 |
| **AR_100** | MaxDets=100 的 AR | 每张图取前 100 个框计算召回率。通常接近模型能达到的召回率上限。 |

## 3. 计算细节

1. **101点插值法**:
   我们在计算 AP 时，采用 COCO 标准的 101 点插值法。即在 recall = [0.00, 0.01, ..., 1.00] 这 101 个点上取对应的最大 precision 并求平均。这比传统的 11 点插值法更精确。

2. **多尺度评估逻辑**:
   - 计算 `mAP_s` 时，我们只保留真实面积在 `[0, 32^2)` 范围内的 GT，并且只考虑面积在该范围内的预测框。
   - 如果某张图片没有该尺度的目标，则不参与该尺度的计算。

## 4. 总结建议

- **如果只看一个数**: 关注 **mAP**。
- **如果定位精度很重要**: 关注 **mAP_75**。
- **如果漏检代价很大** (如自动驾驶): 关注 **AR_100**。
- **如果发现小物体检测很差**: 关注 **mAP_s**，可能需要调整数据增强或模型结构。

## 5. 最佳阈值推荐 (Best Score Suggestion)

EasyMetrics 支持根据指定的精度 (Precision) 要求，自动寻找最佳的置信度阈值。这对于实际部署模型时设定阈值非常有帮助。

| 指标键名 | 含义 | 详细解释 |
| :--- | :--- | :--- |
| **BestScore_IoU0.50_P0.90_<class_id>** | 满足精度要求的最低阈值 | 在 IoU=0.50 的评估标准下，为了让该类别的预测精度达到 90%，建议设置的最低置信度阈值。 |
