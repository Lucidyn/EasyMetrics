# EasyMetrics ä½¿ç”¨æŒ‡å—

EasyMetrics æ˜¯ä¸€ä¸ªè½»é‡çº§ã€é›¶ä¾èµ–çš„æœºå™¨å­¦ä¹ æŒ‡æ ‡è¯„ä¼°å¹³å°ï¼Œä¸“æ³¨äºæä¾›ç®€å•æ˜“ç”¨ä¸”å‡†ç¡®çš„æ¨¡å‹è¯„ä¼°å·¥å…·ã€‚

## ğŸ“¦ å®‰è£…ä¸é…ç½®

### ä» PyPI å®‰è£… (æ¨è)

EasyMetrics å·²å‘å¸ƒåˆ° PyPIï¼Œå¯ä»¥é€šè¿‡ pip ç›´æ¥å®‰è£…ï¼š

```bash
pip install EasyMetrics
```

### ä» GitHub å®‰è£…

ä¹Ÿå¯ä»¥ä» GitHub ä»“åº“å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼š

```bash
pip install git+https://github.com/Lucidyn/EasyMetrics.git
```

### æœ¬åœ°å®‰è£…

å¦‚æœä½ éœ€è¦ä¿®æ”¹æºç æˆ–ä½¿ç”¨å¼€å‘ç‰ˆæœ¬ï¼Œå¯ä»¥å…‹éš†ä»“åº“åæœ¬åœ°å®‰è£…ï¼š

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/Lucidyn/EasyMetrics.git

# è¿›å…¥ç›®å½•
cd EasyMetrics

# å®‰è£…ä¸ºå¯ç¼–è¾‘æ¨¡å¼
pip install -e .
```

### ä¾èµ–é¡¹

EasyMetrics çš„ä¾èµ–éå¸¸ç²¾ç®€ï¼š
- **æ ¸å¿ƒä¾èµ–**: numpy >= 1.17.0
- **å¯é€‰ä¾èµ–**: tqdm (ç”¨äºè¿›åº¦æ¡åŠŸèƒ½)

å¦‚æœéœ€è¦è¿›åº¦æ¡åŠŸèƒ½ï¼Œå¯ä»¥å®‰è£… tqdmï¼š

```bash
pip install tqdm
```

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½ä½¿ç”¨

### æ ¸å¿ƒæ¥å£è¯´æ˜

EasyMetrics æä¾›äº†ä¸‰ä¸ªæ ¸å¿ƒæ¥å£ï¼Œä»é¡¶å±‚ç›´æ¥å¯¼å…¥ä½¿ç”¨ï¼š

- **evaluate**ï¼šç»Ÿä¸€è¯„æµ‹æ¥å£ï¼Œæ”¯æŒè‡ªåŠ¨æ£€æµ‹ä»»åŠ¡ç±»å‹
- **evaluate_detection**ï¼šæ£€æµ‹ä»»åŠ¡ä¸“ç”¨æ¥å£
- **evaluate_classification**ï¼šåˆ†ç±»ä»»åŠ¡ä¸“ç”¨æ¥å£

### 1. ç›®æ ‡æ£€æµ‹è¯„ä¼°

#### åŸºæœ¬ç”¨æ³•

```python
import numpy as np
from easyMetrics import evaluate_detection

# å‡†å¤‡æ•°æ® - æ¯å¼ å›¾ç‰‡ä¸€ä¸ªå­—å…¸
preds = [{
    'boxes': np.array([[100, 100, 200, 200]]),  # [x1, y1, x2, y2] æ ¼å¼
    'scores': np.array([0.9]),                  # ç½®ä¿¡åº¦åˆ†æ•°
    'labels': np.array([0])                     # ç±»åˆ«ç´¢å¼•
}]
targets = [{
    'boxes': np.array([[100, 100, 200, 200]]),  # çœŸå®è¾¹ç•Œæ¡†
    'labels': np.array([0])                     # çœŸå®ç±»åˆ«
}]

# è¯„ä¼°å¹¶è·å–ç»“æœ
results = evaluate_detection(preds, targets)

# æ‰“å°å…³é”®æŒ‡æ ‡
print(f"mAP: {results['mAP']:.4f}")
print(f"mAP_50: {results['mAP_50']:.4f}")
print(f"mAP_75: {results['mAP_75']:.4f}")
print(f"AR_100: {results['AR_100']:.4f}")
```

#### é«˜çº§åŠŸèƒ½

##### 1.1 å¯»æ‰¾æœ€ä½³ç½®ä¿¡åº¦é˜ˆå€¼

**åŠŸèƒ½è¯´æ˜**ï¼šè‡ªåŠ¨è®¡ç®—æ»¡è¶³ç‰¹å®šç²¾åº¦è¦æ±‚çš„æœ€ä½³ç½®ä¿¡åº¦é˜ˆå€¼ï¼Œå¸®åŠ©ä½ ç¡®å®šæ¨¡å‹ä¸Šçº¿æ—¶çš„é˜ˆå€¼è®¾ç½®ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- è¦æ±‚æ¨¡å‹åœ¨ IoU=0.5 æ—¶ç²¾åº¦è‡³å°‘è¾¾åˆ° 90%
- éœ€è¦ä¸ºä¸åŒç±»åˆ«è®¾ç½®ä¸åŒçš„é˜ˆå€¼

**ç¤ºä¾‹ä»£ç **ï¼š

```python
# åœºæ™¯ 1: IoU=0.5 æ—¶ç²¾åº¦è‡³å°‘è¾¾åˆ° 90%
results = evaluate_detection(
    preds, targets,
    score_criteria=[(0.5, 0.9)]  # æ ¼å¼: [(ioué˜ˆå€¼, æœ€ä½ç²¾åº¦è¦æ±‚)]
)

# è·å–ç±»åˆ« 0 çš„æœ€ä½³é˜ˆå€¼
best_thresh = results.get('BestScore_IoU0.50_P0.90_0')
print(f"ç±»åˆ« 0 çš„æ¨èé˜ˆå€¼: {best_thresh}")

# åœºæ™¯ 2: å¤šä¸ªç²¾åº¦è¦æ±‚
results = evaluate_detection(
    preds, targets,
    score_criteria=[(0.5, 0.9), (0.75, 0.8)]
)

# è·å–ä¸åŒè¦æ±‚ä¸‹çš„é˜ˆå€¼
best_thresh_50 = results.get('BestScore_IoU0.50_P0.90_0')
best_thresh_75 = results.get('BestScore_IoU0.75_P0.80_0')
```

##### 1.2 å¹¶è¡ŒåŠ é€Ÿè®¡ç®—

**åŠŸèƒ½è¯´æ˜**ï¼šå¯¹äºå¤§è§„æ¨¡æ•°æ®é›†ï¼Œå¯ç”¨å¤šæ ¸å¹¶è¡Œè®¡ç®—ä»¥æé«˜è¯„ä¼°é€Ÿåº¦ã€‚

**ä½¿ç”¨æ–¹æ³•**ï¼š

```python
# ä½¿ç”¨ 4 ä¸ªæ ¸å¿ƒè¿›è¡Œè¯„ä¼°
results = evaluate_detection(preds, targets, n_jobs=4)

# ä½¿ç”¨æ‰€æœ‰å¯ç”¨æ ¸å¿ƒ
results = evaluate_detection(preds, targets, n_jobs=-1)
```

##### 1.3 è‡ªå®šä¹‰æŒ‡æ ‡ç­›é€‰

**åŠŸèƒ½è¯´æ˜**ï¼šåªè®¡ç®—ä½ å…³å¿ƒçš„æŒ‡æ ‡ï¼Œå‡å°‘è¾“å‡ºå¹²æ‰°ï¼Œæé«˜è®¡ç®—æ•ˆç‡ã€‚

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```python
# åªè®¡ç®— mAP å’Œ mAP_50
results = evaluate_detection(preds, targets, metrics=['mAP', 'mAP_50'])
print(results)

# åªè®¡ç®—å¬å›ç‡ç›¸å…³æŒ‡æ ‡
results = evaluate_detection(preds, targets, metrics=['AR_100', 'AR_10'])
print(results)

# åªè®¡ç®—ç‰¹å®šå°ºåº¦çš„æŒ‡æ ‡
results = evaluate_detection(preds, targets, metrics=['mAP_s', 'mAP_m', 'mAP_l'])
print(results)
```

##### 1.4 æ¨¡å‹æ¯”è¾ƒä¸åˆ†æ

**åŠŸèƒ½è¯´æ˜**ï¼šä½¿ç”¨ EasyMetrics æ¯”è¾ƒä¸åŒæ¨¡å‹çš„æ€§èƒ½ï¼Œåˆ†ææ¨¡å‹åœ¨ä¸åŒåœºæ™¯ä¸‹çš„è¡¨ç°ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- æ¯”è¾ƒä¸åŒè®­ç»ƒç­–ç•¥çš„æ¨¡å‹æ€§èƒ½
- åˆ†ææ¨¡å‹åœ¨ä¸åŒå°ºåº¦ç›®æ ‡ä¸Šçš„è¡¨ç°
- è¯„ä¼°æ¨¡å‹åœ¨ä¸åŒ IoU é˜ˆå€¼ä¸‹çš„ç¨³å®šæ€§

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```python
# å‡è®¾æˆ‘ä»¬æœ‰ä¸¤ä¸ªæ¨¡å‹çš„é¢„æµ‹ç»“æœ
model1_preds = [...]  # æ¨¡å‹ 1 çš„é¢„æµ‹
model2_preds = [...]  # æ¨¡å‹ 2 çš„é¢„æµ‹
targets = [...]       # çœŸå®æ ‡ç­¾

# è¯„ä¼°æ¨¡å‹ 1
results1 = evaluate_detection(model1_preds, targets)

# è¯„ä¼°æ¨¡å‹ 2
results2 = evaluate_detection(model2_preds, targets)

# æ¯”è¾ƒæ¨¡å‹æ€§èƒ½
print("=== æ¨¡å‹æ€§èƒ½æ¯”è¾ƒ ===")
print(f"æ¨¡å‹ 1 mAP: {results1['mAP']:.4f}")
print(f"æ¨¡å‹ 2 mAP: {results2['mAP']:.4f}")
print(f"æ€§èƒ½å·®å¼‚: {(results2['mAP'] - results1['mAP']):.4f}")

# åˆ†ææ¨¡å‹åœ¨ä¸åŒå°ºåº¦ä¸Šçš„è¡¨ç°
print("\n=== æ¨¡å‹åœ¨ä¸åŒå°ºåº¦ä¸Šçš„è¡¨ç° ===")
print(f"æ¨¡å‹ 1 å°ç›®æ ‡ mAP_s: {results1['mAP_s']:.4f}")
print(f"æ¨¡å‹ 2 å°ç›®æ ‡ mAP_s: {results2['mAP_s']:.4f}")
print(f"æ¨¡å‹ 1 ä¸­ç›®æ ‡ mAP_m: {results1['mAP_m']:.4f}")
print(f"æ¨¡å‹ 2 ä¸­ç›®æ ‡ mAP_m: {results2['mAP_m']:.4f}")
print(f"æ¨¡å‹ 1 å¤§ç›®æ ‡ mAP_l: {results1['mAP_l']:.4f}")
print(f"æ¨¡å‹ 2 å¤§ç›®æ ‡ mAP_l: {results2['mAP_l']:.4f}")

# åˆ†ææ¨¡å‹åœ¨ä¸åŒ IoU é˜ˆå€¼ä¸‹çš„è¡¨ç°
print("\n=== æ¨¡å‹åœ¨ä¸åŒ IoU é˜ˆå€¼ä¸‹çš„è¡¨ç° ===")
print(f"æ¨¡å‹ 1 IoU=0.5: {results1['mAP_50']:.4f}")
print(f"æ¨¡å‹ 2 IoU=0.5: {results2['mAP_50']:.4f}")
print(f"æ¨¡å‹ 1 IoU=0.75: {results1['mAP_75']:.4f}")
print(f"æ¨¡å‹ 2 IoU=0.75: {results2['mAP_75']:.4f}")
```

## ğŸ“Š æ•°æ®æ ¼å¼è¯¦è§£

### é¢„æµ‹ç»“æœ (preds)

`preds` æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ å¯¹åº”ä¸€å¼ å›¾ç‰‡çš„é¢„æµ‹ç»“æœï¼Œæ ¼å¼ä¸ºå­—å…¸ï¼š

| é”®å | ç±»å‹ | å½¢çŠ¶ | è¯´æ˜ |
|------|------|------|------|
| `boxes` | numpy.ndarray | (N, 4) | é¢„æµ‹çš„è¾¹ç•Œæ¡†ï¼Œæ ¼å¼ä¸º `[x1, y1, x2, y2]` |
| `scores` | numpy.ndarray | (N,) | æ¯ä¸ªé¢„æµ‹æ¡†çš„ç½®ä¿¡åº¦åˆ†æ•° |
| `labels` | numpy.ndarray | (N,) | æ¯ä¸ªé¢„æµ‹æ¡†çš„ç±»åˆ«ç´¢å¼• (æ•´æ•°) |

### çœŸå®æ ‡ç­¾ (targets)

`targets` æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ å¯¹åº”ä¸€å¼ å›¾ç‰‡çš„çœŸå®æ ‡ç­¾ï¼Œæ ¼å¼ä¸ºå­—å…¸ï¼š

| é”®å | ç±»å‹ | å½¢çŠ¶ | è¯´æ˜ |
|------|------|------|------|
| `boxes` | numpy.ndarray | (M, 4) | çœŸå®çš„è¾¹ç•Œæ¡†ï¼Œæ ¼å¼ä¸º `[x1, y1, x2, y2]` |
| `labels` | numpy.ndarray | (M,) | çœŸå®çš„ç±»åˆ«ç´¢å¼• (æ•´æ•°) |

### æ•°æ®æ ¼å¼ç¤ºä¾‹

```python
# ä¸¤å¼ å›¾ç‰‡çš„ç¤ºä¾‹æ•°æ®
preds = [
    # å›¾ç‰‡ 1 çš„é¢„æµ‹
    {
        'boxes': np.array([[10, 10, 50, 50], [100, 100, 150, 150]]),
        'scores': np.array([0.95, 0.8]),
        'labels': np.array([0, 1])
    },
    # å›¾ç‰‡ 2 çš„é¢„æµ‹
    {
        'boxes': np.array([[200, 200, 250, 250]]),
        'scores': np.array([0.9]),
        'labels': np.array([0])
    }
]

targets = [
    # å›¾ç‰‡ 1 çš„çœŸå®æ ‡ç­¾
    {
        'boxes': np.array([[10, 10, 50, 50], [100, 100, 150, 150]]),
        'labels': np.array([0, 1])
    },
    # å›¾ç‰‡ 2 çš„çœŸå®æ ‡ç­¾
    {
        'boxes': np.array([[200, 200, 250, 250], [300, 300, 350, 350]]),
        'labels': np.array([0, 1])
    }
]
```

## ğŸ”§ æ‰©å±•ä¸å®šåˆ¶

### æ·»åŠ æ–°ä»»åŠ¡

è¦æ·»åŠ æ–°çš„è¯„ä¼°ä»»åŠ¡ï¼ˆå¦‚åˆ†ç±»ã€åˆ†å‰²ç­‰ï¼‰ï¼š

1. åœ¨ `easyMetrics/tasks/` ä¸‹åˆ›å»ºæ–°ç›®å½•ï¼ˆä¾‹å¦‚ `classification`ï¼‰
2. åˆ›å»ºè¯„ä¼°æ¥å£æ–‡ä»¶ï¼ˆä¾‹å¦‚ `interface.py`ï¼‰
3. ç»§æ‰¿ `easyMetrics.core.Metric` åŸºç±»
4. å®ç° `reset()`, `update()` å’Œ `compute()` æ–¹æ³•

### è‡ªå®šä¹‰åŒ¹é…ç­–ç•¥

EasyMetrics æ”¯æŒè‡ªå®šä¹‰åŒ¹é…ç­–ç•¥ï¼Œè¯¦æƒ…è¯·å‚è€ƒæºç ä¸­çš„ `matcher.py` æ–‡ä»¶ã€‚

## ğŸ“Š åˆ†ç±»ä»»åŠ¡è¯„ä¼°

### äºŒåˆ†ç±»ç¤ºä¾‹

```python
import numpy as np
from easyMetrics import evaluate_classification

# é¢„æµ‹ç»“æœå’ŒçœŸå®æ ‡ç­¾
binary_preds = [0.8, 0.3, 0.6, 0.9, 0.2]
binary_targets = [1, 0, 1, 1, 0]

# è¯„ä¼°å¹¶è·å–ç»“æœ
results = evaluate_classification(binary_preds, binary_targets)

# æ‰“å°å…³é”®æŒ‡æ ‡
print(f"F1 Score: {results['f1']:.4f}")
print(f"Precision: {results['precision']:.4f}")
print(f"Recall: {results['recall']:.4f}")
print(f"AUC: {results['auc']:.4f}")
```

### å¤šåˆ†ç±»ç¤ºä¾‹

```python
import numpy as np
from easyMetrics import evaluate_classification

# é¢„æµ‹ç»“æœå’ŒçœŸå®æ ‡ç­¾
multi_preds = [
    [0.9, 0.05, 0.05],  # ç±»åˆ« 0
    [0.1, 0.8, 0.1],   # ç±»åˆ« 1
    [0.2, 0.3, 0.5],   # ç±»åˆ« 2
    [0.8, 0.1, 0.1]    # ç±»åˆ« 0
]
multi_targets = [0, 1, 2, 0]

# è¯„ä¼°å¹¶è·å–ç»“æœ
results = evaluate_classification(multi_preds, multi_targets, multi_class='ovr')

# æ‰“å°å…³é”®æŒ‡æ ‡
print(f"F1 Score: {results['f1']:.4f}")
print(f"Precision: {results['precision']:.4f}")
print(f"Recall: {results['recall']:.4f}")
print(f"AUC: {results['auc']:.4f}")
```

### å¤šæ ‡ç­¾ç¤ºä¾‹

```python
import numpy as np
from easyMetrics import evaluate_classification

# é¢„æµ‹ç»“æœå’ŒçœŸå®æ ‡ç­¾
multi_label_preds = [
    [0.9, 0.8, 0.1],  # æ ‡ç­¾ 0 å’Œ 1
    [0.2, 0.6, 0.7],   # æ ‡ç­¾ 1 å’Œ 2
    [0.8, 0.3, 0.2],   # æ ‡ç­¾ 0
    [0.1, 0.2, 0.3]    # æ— æ ‡ç­¾
]
multi_label_targets = [
    [1, 1, 0],  # æ ‡ç­¾ 0 å’Œ 1
    [0, 1, 1],   # æ ‡ç­¾ 1 å’Œ 2
    [1, 0, 0],   # æ ‡ç­¾ 0
    [0, 0, 0]    # æ— æ ‡ç­¾
]

# è¯„ä¼°å¹¶è·å–ç»“æœ
results = evaluate_classification(multi_label_preds, multi_label_targets)

# æ‰“å°å…³é”®æŒ‡æ ‡
print(f"F1 Score: {results['f1']:.4f}")
print(f"Precision: {results['precision']:.4f}")
print(f"Recall: {results['recall']:.4f}")
print(f"AUC: {results['auc']:.4f}")
```

### ç»Ÿä¸€è¯„æµ‹æ¥å£ç¤ºä¾‹

```python
import numpy as np
from easyMetrics import evaluate

# åˆ†ç±»ä»»åŠ¡è¯„ä¼°
class_preds = [
    [0.9, 0.1],  # ç±»åˆ« 0
    [0.3, 0.7],  # ç±»åˆ« 1
    [0.6, 0.4],  # ç±»åˆ« 0
    [0.8, 0.2]   # ç±»åˆ« 0
]
class_targets = [0, 1, 0, 0]

# è‡ªåŠ¨æ£€æµ‹ä»»åŠ¡ç±»å‹å¹¶è¯„ä¼°
results = evaluate(class_preds, class_targets)
print(f"åˆ†ç±»ä»»åŠ¡è¯„ä¼°: F1={results['f1']:.4f}, AUC={results['auc']:.4f}")

# æ£€æµ‹ä»»åŠ¡è¯„ä¼°
det_preds = [
    {
        'boxes': [[10, 10, 50, 50]],
        'scores': [0.95],
        'labels': [0]
    }
]
det_targets = [
    {
        'boxes': [[10, 10, 50, 50]],
        'labels': [0]
    }
]

# è‡ªåŠ¨æ£€æµ‹ä»»åŠ¡ç±»å‹å¹¶è¯„ä¼°
det_results = evaluate(det_preds, det_targets)
print(f"æ£€æµ‹ä»»åŠ¡è¯„ä¼°: mAP={det_results['mAP']:.4f}")
```

## ğŸ“‹ å‚æ•°è¯¦è§£

### evaluate_detection å‡½æ•°å‚æ•°è¯´æ˜

#### æ ¸å¿ƒå‚æ•°

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| **preds** | List[Any] | å¿…å¡« | æ¯å¼ å›¾ç‰‡çš„é¢„æµ‹ç»“æœåˆ—è¡¨ã€‚æ”¯æŒå¤šç§æ ¼å¼ï¼Œå…·ä½“å–å†³äº `format` æˆ– `pred_format` å‚æ•°ã€‚<br><br>**æ”¯æŒçš„è¾“å…¥ç±»å‹**ï¼š<br>- COCO æ ¼å¼å­—å…¸åˆ—è¡¨<br>- VOC æ ¼å¼åˆ—è¡¨<br>- YOLO æ ¼å¼åˆ—è¡¨<br>- æ ‡é‡ã€åˆ—è¡¨ã€numpy æ•°ç»„ç­‰æ··åˆç±»å‹ |
| **targets** | List[Any] | å¿…å¡« | æ¯å¼ å›¾ç‰‡çš„çœŸå®æ ‡ç­¾åˆ—è¡¨ã€‚æ”¯æŒå¤šç§æ ¼å¼ï¼Œå…·ä½“å–å†³äº `format` æˆ– `target_format` å‚æ•°ã€‚<br><br>**æ”¯æŒçš„è¾“å…¥ç±»å‹**ï¼š<br>- COCO æ ¼å¼å­—å…¸åˆ—è¡¨<br>- VOC æ ¼å¼åˆ—è¡¨<br>- YOLO æ ¼å¼åˆ—è¡¨<br>- æ ‡é‡ã€åˆ—è¡¨ã€numpy æ•°ç»„ç­‰æ··åˆç±»å‹ |
| **metrics** | Optional[List[str]] | None | éœ€è¦è¿”å›çš„ç‰¹å®šæŒ‡æ ‡åˆ—è¡¨ã€‚å¦‚æœä¸º Noneï¼Œåˆ™è¿”å›æ‰€æœ‰è®¡ç®—çš„æŒ‡æ ‡ã€‚<br><br>**å¸¸ç”¨æŒ‡æ ‡**ï¼š<br>- `mAP`: ç»¼åˆè¯„ä¼°æŒ‡æ ‡<br>- `mAP_50`: IoU=0.5 æ—¶çš„ mAP<br>- `mAP_75`: IoU=0.75 æ—¶çš„ mAP<br>- `mAP_s`, `mAP_m`, `mAP_l`: ä¸åŒå°ºåº¦ç›®æ ‡çš„ mAP<br>- `AR_1`, `AR_10`, `AR_100`: ä¸åŒæœ€å¤§æ£€æµ‹æ•°ä¸‹çš„å¬å›ç‡ |
| **n_jobs** | int | 1 | å¹¶è¡Œè®¡ç®—çº¿ç¨‹æ•°ã€‚1 è¡¨ç¤ºä¸²è¡Œè®¡ç®—ï¼Œ-1 è¡¨ç¤ºä½¿ç”¨æ‰€æœ‰å¯ç”¨ CPU æ ¸å¿ƒã€‚<br><br>**å»ºè®®**ï¼š<br>- å°æ•°æ®é›†ï¼šä½¿ç”¨é»˜è®¤å€¼ 1<br>- ä¸­ç­‰æ•°æ®é›†ï¼šä½¿ç”¨ 2-4 ä¸ªæ ¸å¿ƒ<br>- å¤§æ•°æ®é›†ï¼šä½¿ç”¨ -1 æˆ–æ ¹æ®ç³»ç»Ÿé…ç½®é€‰æ‹©åˆé€‚çš„æ ¸å¿ƒæ•° |
| **score_criteria** | Optional[List[Tuple[float, float]]] | None | è®¡ç®—æŒ‡å®š IoU å’Œç²¾åº¦ä¸‹çš„æœ€ä½³ç½®ä¿¡åº¦é˜ˆå€¼ã€‚æ ¼å¼ä¸º `[(iou_thresh, min_precision), ...]`ï¼Œä¾‹å¦‚ `[(0.5, 0.9)]` è¡¨ç¤ºå¯»æ‰¾ IoU=0.5 æ—¶ç²¾åº¦è‡³å°‘ä¸º 0.9 çš„æœ€ä½ç½®ä¿¡åº¦ã€‚ |
| **progress** | bool | True | æ˜¯å¦æ˜¾ç¤ºè¿›åº¦æ¡ã€‚é»˜è®¤ä¸º Trueï¼Œåœ¨è®¡ç®—è¿‡ç¨‹ä¸­æ˜¾ç¤ºè¯„ä¼°è¿›åº¦ã€‚<br><br>**æ³¨æ„**ï¼šè¿›åº¦æ¡åŠŸèƒ½ä¾èµ–äº tqdm åº“ï¼Œå¦‚æœæœªå®‰è£… tqdmï¼Œä¼šè‡ªåŠ¨é™çº§ä¸ºç®€å•çš„æ‰“å°è¾“å‡ºã€‚ |

#### æ ¼å¼å‚æ•°

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| **format** | str | "coco" | è¾“å…¥æ•°æ®çš„é»˜è®¤æ ¼å¼ï¼Œå½“ `pred_format` å’Œ `target_format` æœªæŒ‡å®šæ—¶ä½¿ç”¨ã€‚æ”¯æŒ "coco", "voc", "yolo", "custom"ã€‚ |
| **pred_format** | Optional[str] | None | é¢„æµ‹ç»“æœçš„æ ¼å¼ï¼Œä¼˜å…ˆçº§é«˜äº `format`ã€‚<br><br>**æ”¯æŒçš„æ ¼å¼**ï¼š<br>- "coco": COCO æ ¼å¼<br>- "voc": VOC æ ¼å¼<br>- "yolo": YOLO æ ¼å¼<br>- "custom": è‡ªå®šä¹‰æ ¼å¼ |
| **target_format** | Optional[str] | None | çœŸå®æ ‡ç­¾çš„æ ¼å¼ï¼Œä¼˜å…ˆçº§é«˜äº `format`ã€‚<br><br>**æ”¯æŒçš„æ ¼å¼**ï¼š<br>- "coco": COCO æ ¼å¼<br>- "voc": VOC æ ¼å¼<br>- "yolo": YOLO æ ¼å¼<br>- "custom": è‡ªå®šä¹‰æ ¼å¼ |

#### é¢å¤–å‚æ•°ï¼ˆ**kwargsï¼‰

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| **image_size** | Tuple[int, int] | (640, 640) | YOLO æ ¼å¼éœ€è¦çš„å›¾åƒå°ºå¯¸ (width, height)ï¼Œç”¨äºå°†å½’ä¸€åŒ–åæ ‡è½¬æ¢ä¸ºç»å¯¹åæ ‡ã€‚<br><br>**ç¤ºä¾‹**ï¼š<br>- `(640, 640)`: æ­£æ–¹å½¢å›¾åƒ<br>- `(1920, 1080)`: é«˜æ¸…å›¾åƒ |
| **custom_converter** | Callable | None | è‡ªå®šä¹‰æ ¼å¼çš„è½¬æ¢å‡½æ•°ï¼Œå½“ `format` ä¸º "custom" æ—¶ä½¿ç”¨ã€‚<br><br>**å‡½æ•°ç­¾å**ï¼š<br>```python
def custom_converter(data, is_prediction):
    """å°†è‡ªå®šä¹‰æ ¼å¼è½¬æ¢ä¸ºå†…éƒ¨æ ‡å‡†æ ¼å¼"""
    # å¤„ç†é€»è¾‘
    return converted_data
``` |

#### æ ¼å¼è¯´æ˜

##### COCO æ ¼å¼

**é¢„æµ‹ç»“æœ**ï¼š
```python
{
    'boxes': np.array([[x1, y1, x2, y2], ...]),  # è¾¹ç•Œæ¡†åæ ‡
    'scores': np.array([score1, score2, ...]),     # ç½®ä¿¡åº¦åˆ†æ•°
    'labels': np.array([label1, label2, ...])      # ç±»åˆ«ç´¢å¼•
}
```

**çœŸå®æ ‡ç­¾**ï¼š
```python
{
    'boxes': np.array([[x1, y1, x2, y2], ...]),  # è¾¹ç•Œæ¡†åæ ‡
    'labels': np.array([label1, label2, ...])      # ç±»åˆ«ç´¢å¼•
}
```

##### VOC æ ¼å¼

**é¢„æµ‹ç»“æœ**ï¼š
```python
[[x1, y1, x2, y2, class_id, confidence], ...]
```

**çœŸå®æ ‡ç­¾**ï¼š
```python
[[x1, y1, x2, y2, class_id], ...]
```

##### YOLO æ ¼å¼

**é¢„æµ‹ç»“æœ**ï¼š
```python
[[class_id, x_center, y_center, width, height, confidence], ...]
```

**çœŸå®æ ‡ç­¾**ï¼š
```python
[[class_id, x_center, y_center, width, height], ...]
```

**æ³¨æ„**ï¼šYOLO æ ¼å¼çš„åæ ‡æ˜¯å½’ä¸€åŒ–çš„ (0-1)ï¼Œéœ€è¦æä¾› `image_size` å‚æ•°è¿›è¡Œè½¬æ¢ã€‚

#### ç¤ºä¾‹ç”¨æ³•

```python
# åŸºæœ¬ç”¨æ³•
evaluate_detection(preds, targets)

# æŒ‡å®šå¹¶è¡Œè®¡ç®—çº¿ç¨‹æ•°
evaluate_detection(preds, targets, n_jobs=4)

# åªè®¡ç®—ç‰¹å®šæŒ‡æ ‡
evaluate_detection(preds, targets, metrics=['mAP', 'mAP_50'])

# è®¡ç®—æœ€ä½³ç½®ä¿¡åº¦é˜ˆå€¼
evaluate_detection(preds, targets, score_criteria=[(0.5, 0.9)])

# ä½¿ç”¨ä¸åŒæ ¼å¼çš„è¾“å…¥
evaluate_detection(
    preds, targets,
    pred_format="yolo",    # é¢„æµ‹å€¼ä½¿ç”¨ YOLO æ ¼å¼
    target_format="voc",    # çœŸå€¼ä½¿ç”¨ VOC æ ¼å¼
    image_size=(640, 480)    # YOLO æ ¼å¼éœ€è¦çš„å›¾åƒå°ºå¯¸
)

# ç¦ç”¨è¿›åº¦æ¡
evaluate_detection(preds, targets, progress=False)
```

## ğŸ’¡ å®ç”¨æŠ€å·§

1. **æ•°æ®é¢„å¤„ç†**ï¼šç¡®ä¿è¾“å…¥çš„è¾¹ç•Œæ¡†åæ ‡æ ¼å¼æ­£ç¡®ï¼ˆ`[x1, y1, x2, y2]`ï¼‰ï¼Œä¸”ä¸ºæµ®ç‚¹æ•°ç±»å‹ã€‚

2. **ç±»åˆ«ç´¢å¼•**ï¼šç¡®ä¿é¢„æµ‹ç»“æœå’ŒçœŸå®æ ‡ç­¾ä½¿ç”¨ç›¸åŒçš„ç±»åˆ«ç´¢å¼•ä½“ç³»ã€‚

3. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - å¯¹äºå¤§è§„æ¨¡æ•°æ®é›†ï¼Œä½¿ç”¨ `n_jobs=-1` å¯ç”¨å¹¶è¡Œè®¡ç®—
   - ä½¿ç”¨ `metrics` å‚æ•°åªè®¡ç®—éœ€è¦çš„æŒ‡æ ‡

4. **ç»“æœåˆ†æ**ï¼š
   - å…³æ³¨ `mAP_50` æŒ‡æ ‡è¯„ä¼°æ¨¡å‹åœ¨å®½æ¾æ¡ä»¶ä¸‹çš„æ€§èƒ½
   - å…³æ³¨ `mAP_75` æŒ‡æ ‡è¯„ä¼°æ¨¡å‹åœ¨ä¸¥æ ¼æ¡ä»¶ä¸‹çš„æ€§èƒ½
   - ä½¿ç”¨ `AR_100` è¯„ä¼°æ¨¡å‹çš„å¬å›èƒ½åŠ›

## ğŸš‘ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

#### 1. å¯¼å…¥é”™è¯¯

**é—®é¢˜**ï¼š`ModuleNotFoundError: No module named 'easyMetrics'`

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿å·²æ­£ç¡®å®‰è£… EasyMetricsï¼š`pip install EasyMetrics`
- æ£€æŸ¥ Python ç¯å¢ƒæ˜¯å¦æ­£ç¡®
- æ£€æŸ¥é¡¹ç›®ç»“æ„ï¼Œç¡®ä¿ easyMetrics æ–‡ä»¶å¤¹åœ¨æ­£ç¡®çš„ä½ç½®

#### 2. æ•°æ®æ ¼å¼é”™è¯¯

**é—®é¢˜**ï¼š`KeyError: 'boxes'` æˆ– `ValueError: not enough values to unpack`

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥è¾“å…¥æ•°æ®æ ¼å¼æ˜¯å¦æ­£ç¡®
- ç¡®ä¿ `preds` å’Œ `targets` æ˜¯åˆ—è¡¨æ ¼å¼
- ç¡®ä¿æ¯ä¸ªå…ƒç´ åŒ…å«æ­£ç¡®çš„é”®ï¼ˆå¦‚ 'boxes'ã€'scores'ã€'labels'ï¼‰
- å¯¹äºä¸åŒæ ¼å¼çš„è¾“å…¥ï¼Œç¡®ä¿æŒ‡å®šäº†æ­£ç¡®çš„ `pred_format` å’Œ `target_format`

#### 3. ç±»å‹é”™è¯¯

**é—®é¢˜**ï¼š`TypeError: 'int' object is not iterable` æˆ– `TypeError: expected sequence or array-like, got int`

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥è¾“å…¥æ•°æ®ç±»å‹æ˜¯å¦æ­£ç¡®
- å¯¹äºæ ‡é‡è¾“å…¥ï¼Œç¡®ä¿å®ƒä»¬å¯ä»¥è¢«æ­£ç¡®è½¬æ¢ä¸ºæ•°ç»„
- ç¡®ä¿ `boxes`ã€`scores` å’Œ `labels` æ˜¯å¯è¿­ä»£å¯¹è±¡

#### 4. ç»´åº¦é”™è¯¯

**é—®é¢˜**ï¼š`IndexError: boolean index did not match indexed array along dimension` æˆ– `ValueError: shapes (N,) and (M,) not aligned`

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥ `boxes` æ•°ç»„çš„ç»´åº¦æ˜¯å¦æ­£ç¡®ï¼ˆåº”ä¸º (N, 4)ï¼‰
- ç¡®ä¿ `scores` å’Œ `labels` çš„é•¿åº¦ä¸ `boxes` çš„é•¿åº¦ä¸€è‡´
- ç¡®ä¿æ¯å¼ å›¾ç‰‡çš„é¢„æµ‹ç»“æœå’ŒçœŸå®æ ‡ç­¾æ ¼å¼ä¸€è‡´

#### 5. æ€§èƒ½é—®é¢˜

**é—®é¢˜**ï¼šè¯„ä¼°é€Ÿåº¦å¤ªæ…¢

**è§£å†³æ–¹æ¡ˆ**ï¼š
- å¯ç”¨å¹¶è¡Œè®¡ç®—ï¼š`n_jobs=-1` æˆ–æŒ‡å®šåˆé€‚çš„æ ¸å¿ƒæ•°
- åªè®¡ç®—éœ€è¦çš„æŒ‡æ ‡ï¼š`metrics=['mAP', 'mAP_50']`
- å¯¹äºå¤§è§„æ¨¡æ•°æ®é›†ï¼Œè€ƒè™‘åˆ†æ‰¹è¯„ä¼°

#### 6. ç»“æœå¼‚å¸¸

**é—®é¢˜**ï¼šè¯„ä¼°ç»“æœä¸º 0 æˆ–å¼‚å¸¸å€¼

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥è¾“å…¥æ•°æ®æ˜¯å¦ä¸ºç©º
- æ£€æŸ¥ç±»åˆ«ç´¢å¼•æ˜¯å¦æ­£ç¡®
- æ£€æŸ¥è¾¹ç•Œæ¡†åæ ‡æ˜¯å¦åœ¨æ­£ç¡®çš„èŒƒå›´å†…
- æ£€æŸ¥ IoU è®¡ç®—æ˜¯å¦æ­£ç¡®

### è°ƒè¯•æŠ€å·§

1. **é€æ­¥è°ƒè¯•**ï¼šä»å°è§„æ¨¡æ•°æ®å¼€å§‹æµ‹è¯•ï¼Œç¡®ä¿åŸºæœ¬åŠŸèƒ½æ­£å¸¸

2. **æ•°æ®éªŒè¯**ï¼šåœ¨è¯„ä¼°å‰éªŒè¯è¾“å…¥æ•°æ®çš„æ ¼å¼å’Œå†…å®¹

3. **æ—¥å¿—è¾“å‡º**ï¼šä½¿ç”¨ `print` è¯­å¥æˆ–æ—¥å¿—è®°å½•ä¸­é—´ç»“æœ

4. **ç®€åŒ–æµ‹è¯•**ï¼šåˆ›å»ºæœ€å°å¤ç°æ¡ˆä¾‹ï¼Œéš”ç¦»é—®é¢˜

5. **æŸ¥çœ‹æºç **ï¼šå¦‚æœé‡åˆ°å¤æ‚é—®é¢˜ï¼Œå¯ä»¥æŸ¥çœ‹ç›¸å…³æºç æ–‡ä»¶äº†è§£å®ç°ç»†èŠ‚

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **æŒ‡æ ‡è¯¦è§£.md**ï¼šè¯¦ç»†ä»‹ç»å„ç§è¯„ä¼°æŒ‡æ ‡çš„è®¡ç®—åŸç†
- **README.md**ï¼šé¡¹ç›®æ¦‚è¿°å’Œå¿«é€Ÿå¼€å§‹æŒ‡å—
- **demo.py**ï¼šå®Œæ•´çš„ä»£ç ç¤ºä¾‹ï¼Œè¦†ç›–æ‰€æœ‰ä¸»è¦åŠŸèƒ½
