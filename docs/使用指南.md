# EasyMetrics ä½¿ç”¨æŒ‡å—

EasyMetrics æ˜¯ä¸€ä¸ªè½»é‡çº§ã€é›¶ä¾èµ–çš„æœºå™¨å­¦ä¹ æŒ‡æ ‡è¯„ä¼°å¹³å°ï¼Œä¸“æ³¨äºæä¾›ç®€å•æ˜“ç”¨ä¸”å‡†ç¡®çš„æ¨¡å‹è¯„ä¼°å·¥å…·ã€‚

## ğŸ“¦ å®‰è£…ä¸é…ç½®

### å¿«é€Ÿå®‰è£…
åªéœ€å°† `easy_metrics` æ–‡ä»¶å¤¹å¤åˆ¶åˆ°ä½ çš„é¡¹ç›®ä¸­ï¼Œå¹¶ç¡®ä¿å®‰è£…äº† `numpy`ï¼š

```bash
pip install numpy
```

## ğŸš€ æ ¸å¿ƒåŠŸèƒ½ä½¿ç”¨

### 1. ç›®æ ‡æ£€æµ‹è¯„ä¼°

#### åŸºæœ¬ç”¨æ³•

```python
import numpy as np
from easyMetrics.tasks.detection import evaluate_detection

# å‡†å¤‡æ•°æ® - æ¯å¼ å›¾ç‰‡ä¸€ä¸ªå­—å…¸
preds = [{
    'boxes': np.array([[100, 100, 200, 200]]),  # [x1, y1, x2, y2] æ ¼å¼
    'scores': np.array([0.9]),                  # ç½®ä¿¡åº¦åˆ†æ•°
    'labels': np.array([0])                     # ç±»åˆ«ç´¢å¼•
}]
targets = [{
    'boxes': np.array([[100, 100, 200, 200]]),  # çœŸå®è¾¹ç•Œæ¡†
    'labels': np.array([0])                     # çœŸå®ç±»åˆ«
}]

# è¯„ä¼°å¹¶è·å–ç»“æœ
results = evaluate_detection(preds, targets)

# æ‰“å°å…³é”®æŒ‡æ ‡
print(f"mAP: {results['mAP']:.4f}")
print(f"mAP_50: {results['mAP_50']:.4f}")
print(f"mAP_75: {results['mAP_75']:.4f}")
print(f"AR_100: {results['AR_100']:.4f}")
```

#### é«˜çº§åŠŸèƒ½

##### 1.1 å¯»æ‰¾æœ€ä½³ç½®ä¿¡åº¦é˜ˆå€¼

**åŠŸèƒ½è¯´æ˜**ï¼šè‡ªåŠ¨è®¡ç®—æ»¡è¶³ç‰¹å®šç²¾åº¦è¦æ±‚çš„æœ€ä½³ç½®ä¿¡åº¦é˜ˆå€¼ï¼Œå¸®åŠ©ä½ ç¡®å®šæ¨¡å‹ä¸Šçº¿æ—¶çš„é˜ˆå€¼è®¾ç½®ã€‚

**ä½¿ç”¨åœºæ™¯**ï¼š
- è¦æ±‚æ¨¡å‹åœ¨ IoU=0.5 æ—¶ç²¾åº¦è‡³å°‘è¾¾åˆ° 90%
- éœ€è¦ä¸ºä¸åŒç±»åˆ«è®¾ç½®ä¸åŒçš„é˜ˆå€¼

**ç¤ºä¾‹ä»£ç **ï¼š

```python
# åœºæ™¯ 1: IoU=0.5 æ—¶ç²¾åº¦è‡³å°‘è¾¾åˆ° 90%
results = evaluate_detection(
    preds, targets,
    score_criteria=[(0.5, 0.9)]  # æ ¼å¼: [(ioué˜ˆå€¼, æœ€ä½ç²¾åº¦è¦æ±‚)]
)

# è·å–ç±»åˆ« 0 çš„æœ€ä½³é˜ˆå€¼
best_thresh = results.get('BestScore_IoU0.50_P0.90_0')
print(f"ç±»åˆ« 0 çš„æ¨èé˜ˆå€¼: {best_thresh}")

# åœºæ™¯ 2: å¤šä¸ªç²¾åº¦è¦æ±‚
results = evaluate_detection(
    preds, targets,
    score_criteria=[(0.5, 0.9), (0.75, 0.8)]
)

# è·å–ä¸åŒè¦æ±‚ä¸‹çš„é˜ˆå€¼
best_thresh_50 = results.get('BestScore_IoU0.50_P0.90_0')
best_thresh_75 = results.get('BestScore_IoU0.75_P0.80_0')
```

##### 1.2 å¹¶è¡ŒåŠ é€Ÿè®¡ç®—

**åŠŸèƒ½è¯´æ˜**ï¼šå¯¹äºå¤§è§„æ¨¡æ•°æ®é›†ï¼Œå¯ç”¨å¤šæ ¸å¹¶è¡Œè®¡ç®—ä»¥æé«˜è¯„ä¼°é€Ÿåº¦ã€‚

**ä½¿ç”¨æ–¹æ³•**ï¼š

```python
# ä½¿ç”¨ 4 ä¸ªæ ¸å¿ƒè¿›è¡Œè¯„ä¼°
results = evaluate_detection(preds, targets, n_jobs=4)

# ä½¿ç”¨æ‰€æœ‰å¯ç”¨æ ¸å¿ƒ
results = evaluate_detection(preds, targets, n_jobs=-1)
```

##### 1.3 è‡ªå®šä¹‰æŒ‡æ ‡ç­›é€‰

**åŠŸèƒ½è¯´æ˜**ï¼šåªè®¡ç®—ä½ å…³å¿ƒçš„æŒ‡æ ‡ï¼Œå‡å°‘è¾“å‡ºå¹²æ‰°ï¼Œæé«˜è®¡ç®—æ•ˆç‡ã€‚

**ä½¿ç”¨ç¤ºä¾‹**ï¼š

```python
# åªè®¡ç®— mAP å’Œ mAP_50
results = evaluate_detection(preds, targets, metrics=['mAP', 'mAP_50'])
print(results)

# åªè®¡ç®—å¬å›ç‡ç›¸å…³æŒ‡æ ‡
results = evaluate_detection(preds, targets, metrics=['AR_100', 'AR_1000'])
print(results)
```

## ğŸ“Š æ•°æ®æ ¼å¼è¯¦è§£

### é¢„æµ‹ç»“æœ (preds)

`preds` æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ å¯¹åº”ä¸€å¼ å›¾ç‰‡çš„é¢„æµ‹ç»“æœï¼Œæ ¼å¼ä¸ºå­—å…¸ï¼š

| é”®å | ç±»å‹ | å½¢çŠ¶ | è¯´æ˜ |
|------|------|------|------|
| `boxes` | numpy.ndarray | (N, 4) | é¢„æµ‹çš„è¾¹ç•Œæ¡†ï¼Œæ ¼å¼ä¸º `[x1, y1, x2, y2]` |
| `scores` | numpy.ndarray | (N,) | æ¯ä¸ªé¢„æµ‹æ¡†çš„ç½®ä¿¡åº¦åˆ†æ•° |
| `labels` | numpy.ndarray | (N,) | æ¯ä¸ªé¢„æµ‹æ¡†çš„ç±»åˆ«ç´¢å¼• (æ•´æ•°) |

### çœŸå®æ ‡ç­¾ (targets)

`targets` æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¯ä¸ªå…ƒç´ å¯¹åº”ä¸€å¼ å›¾ç‰‡çš„çœŸå®æ ‡ç­¾ï¼Œæ ¼å¼ä¸ºå­—å…¸ï¼š

| é”®å | ç±»å‹ | å½¢çŠ¶ | è¯´æ˜ |
|------|------|------|------|
| `boxes` | numpy.ndarray | (M, 4) | çœŸå®çš„è¾¹ç•Œæ¡†ï¼Œæ ¼å¼ä¸º `[x1, y1, x2, y2]` |
| `labels` | numpy.ndarray | (M,) | çœŸå®çš„ç±»åˆ«ç´¢å¼• (æ•´æ•°) |

### æ•°æ®æ ¼å¼ç¤ºä¾‹

```python
# ä¸¤å¼ å›¾ç‰‡çš„ç¤ºä¾‹æ•°æ®
preds = [
    # å›¾ç‰‡ 1 çš„é¢„æµ‹
    {
        'boxes': np.array([[10, 10, 50, 50], [100, 100, 150, 150]]),
        'scores': np.array([0.95, 0.8]),
        'labels': np.array([0, 1])
    },
    # å›¾ç‰‡ 2 çš„é¢„æµ‹
    {
        'boxes': np.array([[200, 200, 250, 250]]),
        'scores': np.array([0.9]),
        'labels': np.array([0])
    }
]

targets = [
    # å›¾ç‰‡ 1 çš„çœŸå®æ ‡ç­¾
    {
        'boxes': np.array([[10, 10, 50, 50], [100, 100, 150, 150]]),
        'labels': np.array([0, 1])
    },
    # å›¾ç‰‡ 2 çš„çœŸå®æ ‡ç­¾
    {
        'boxes': np.array([[200, 200, 250, 250], [300, 300, 350, 350]]),
        'labels': np.array([0, 1])
    }
]
```

## ğŸ”§ æ‰©å±•ä¸å®šåˆ¶

### æ·»åŠ æ–°ä»»åŠ¡

è¦æ·»åŠ æ–°çš„è¯„ä¼°ä»»åŠ¡ï¼ˆå¦‚åˆ†ç±»ã€åˆ†å‰²ç­‰ï¼‰ï¼š

1. åœ¨ `easyMetrics/tasks/` ä¸‹åˆ›å»ºæ–°ç›®å½•ï¼ˆä¾‹å¦‚ `classification`ï¼‰
2. åˆ›å»ºè¯„ä¼°æ¥å£æ–‡ä»¶ï¼ˆä¾‹å¦‚ `interface.py`ï¼‰
3. ç»§æ‰¿ `easyMetrics.core.Metric` åŸºç±»
4. å®ç° `reset()`, `update()` å’Œ `compute()` æ–¹æ³•

### è‡ªå®šä¹‰åŒ¹é…ç­–ç•¥

EasyMetrics æ”¯æŒè‡ªå®šä¹‰åŒ¹é…ç­–ç•¥ï¼Œè¯¦æƒ…è¯·å‚è€ƒæºç ä¸­çš„ `matcher.py` æ–‡ä»¶ã€‚

## ğŸ“‹ å‚æ•°è¯¦è§£

### evaluate_detection å‡½æ•°å‚æ•°è¯´æ˜

#### æ ¸å¿ƒå‚æ•°

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| **preds** | List[Any] | å¿…å¡« | æ¯å¼ å›¾ç‰‡çš„é¢„æµ‹ç»“æœåˆ—è¡¨ã€‚æ”¯æŒå¤šç§æ ¼å¼ï¼Œå…·ä½“å–å†³äº `format` æˆ– `pred_format` å‚æ•°ã€‚ |
| **targets** | List[Any] | å¿…å¡« | æ¯å¼ å›¾ç‰‡çš„çœŸå®æ ‡ç­¾åˆ—è¡¨ã€‚æ”¯æŒå¤šç§æ ¼å¼ï¼Œå…·ä½“å–å†³äº `format` æˆ– `target_format` å‚æ•°ã€‚ |
| **metrics** | Optional[List[str]] | None | éœ€è¦è¿”å›çš„ç‰¹å®šæŒ‡æ ‡åˆ—è¡¨ã€‚å¦‚æœä¸º Noneï¼Œåˆ™è¿”å›æ‰€æœ‰è®¡ç®—çš„æŒ‡æ ‡ã€‚ |
| **n_jobs** | int | 1 | å¹¶è¡Œè®¡ç®—çº¿ç¨‹æ•°ã€‚1 è¡¨ç¤ºä¸²è¡Œè®¡ç®—ï¼Œ-1 è¡¨ç¤ºä½¿ç”¨æ‰€æœ‰å¯ç”¨ CPU æ ¸å¿ƒã€‚ |
| **score_criteria** | Optional[List[Tuple[float, float]]] | None | è®¡ç®—æŒ‡å®š IoU å’Œç²¾åº¦ä¸‹çš„æœ€ä½³ç½®ä¿¡åº¦é˜ˆå€¼ã€‚æ ¼å¼ä¸º `[(iou_thresh, min_precision), ...]`ï¼Œä¾‹å¦‚ `[(0.5, 0.9)]` è¡¨ç¤ºå¯»æ‰¾ IoU=0.5 æ—¶ç²¾åº¦è‡³å°‘ä¸º 0.9 çš„æœ€ä½ç½®ä¿¡åº¦ã€‚ |
| **progress** | bool | True | æ˜¯å¦æ˜¾ç¤ºè¿›åº¦æ¡ã€‚é»˜è®¤ä¸º Trueï¼Œåœ¨è®¡ç®—è¿‡ç¨‹ä¸­æ˜¾ç¤ºè¯„ä¼°è¿›åº¦ã€‚ |

#### æ ¼å¼å‚æ•°

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| **format** | str | "coco" | è¾“å…¥æ•°æ®çš„é»˜è®¤æ ¼å¼ï¼Œå½“ `pred_format` å’Œ `target_format` æœªæŒ‡å®šæ—¶ä½¿ç”¨ã€‚æ”¯æŒ "coco", "voc", "yolo", "custom"ã€‚ |
| **pred_format** | Optional[str] | None | é¢„æµ‹ç»“æœçš„æ ¼å¼ï¼Œä¼˜å…ˆçº§é«˜äº `format`ã€‚ |
| **target_format** | Optional[str] | None | çœŸå®æ ‡ç­¾çš„æ ¼å¼ï¼Œä¼˜å…ˆçº§é«˜äº `format`ã€‚ |

#### é¢å¤–å‚æ•°ï¼ˆ**kwargsï¼‰

| å‚æ•°å | ç±»å‹ | é»˜è®¤å€¼ | è¯´æ˜ |
| :--- | :--- | :--- | :--- |
| **image_size** | Tuple[int, int] | (640, 640) | YOLO æ ¼å¼éœ€è¦çš„å›¾åƒå°ºå¯¸ (width, height)ï¼Œç”¨äºå°†å½’ä¸€åŒ–åæ ‡è½¬æ¢ä¸ºç»å¯¹åæ ‡ã€‚ |
| **custom_converter** | Callable | None | è‡ªå®šä¹‰æ ¼å¼çš„è½¬æ¢å‡½æ•°ï¼Œå½“ `format` ä¸º "custom" æ—¶ä½¿ç”¨ã€‚ |

#### ç¤ºä¾‹ç”¨æ³•

```python
# åŸºæœ¬ç”¨æ³•
evaluate_detection(preds, targets)

# æŒ‡å®šå¹¶è¡Œè®¡ç®—çº¿ç¨‹æ•°
evaluate_detection(preds, targets, n_jobs=4)

# åªè®¡ç®—ç‰¹å®šæŒ‡æ ‡
evaluate_detection(preds, targets, metrics=['mAP', 'mAP_50'])

# è®¡ç®—æœ€ä½³ç½®ä¿¡åº¦é˜ˆå€¼
evaluate_detection(preds, targets, score_criteria=[(0.5, 0.9)])

# ä½¿ç”¨ä¸åŒæ ¼å¼çš„è¾“å…¥
evaluate_detection(
    preds, targets,
    pred_format="yolo",    # é¢„æµ‹å€¼ä½¿ç”¨ YOLO æ ¼å¼
    target_format="voc",    # çœŸå€¼ä½¿ç”¨ VOC æ ¼å¼
    image_size=(640, 480)    # YOLO æ ¼å¼éœ€è¦çš„å›¾åƒå°ºå¯¸
)

# ç¦ç”¨è¿›åº¦æ¡
evaluate_detection(preds, targets, progress=False)
```

## ğŸ’¡ å®ç”¨æŠ€å·§

1. **æ•°æ®é¢„å¤„ç†**ï¼šç¡®ä¿è¾“å…¥çš„è¾¹ç•Œæ¡†åæ ‡æ ¼å¼æ­£ç¡®ï¼ˆ`[x1, y1, x2, y2]`ï¼‰ï¼Œä¸”ä¸ºæµ®ç‚¹æ•°ç±»å‹ã€‚

2. **ç±»åˆ«ç´¢å¼•**ï¼šç¡®ä¿é¢„æµ‹ç»“æœå’ŒçœŸå®æ ‡ç­¾ä½¿ç”¨ç›¸åŒçš„ç±»åˆ«ç´¢å¼•ä½“ç³»ã€‚

3. **æ€§èƒ½ä¼˜åŒ–**ï¼š
   - å¯¹äºå¤§è§„æ¨¡æ•°æ®é›†ï¼Œä½¿ç”¨ `n_jobs=-1` å¯ç”¨å¹¶è¡Œè®¡ç®—
   - ä½¿ç”¨ `metrics` å‚æ•°åªè®¡ç®—éœ€è¦çš„æŒ‡æ ‡

4. **ç»“æœåˆ†æ**ï¼š
   - å…³æ³¨ `mAP_50` æŒ‡æ ‡è¯„ä¼°æ¨¡å‹åœ¨å®½æ¾æ¡ä»¶ä¸‹çš„æ€§èƒ½
   - å…³æ³¨ `mAP_75` æŒ‡æ ‡è¯„ä¼°æ¨¡å‹åœ¨ä¸¥æ ¼æ¡ä»¶ä¸‹çš„æ€§èƒ½
   - ä½¿ç”¨ `AR_100` è¯„ä¼°æ¨¡å‹çš„å¬å›èƒ½åŠ›

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **æŒ‡æ ‡è¯¦è§£.md**ï¼šè¯¦ç»†ä»‹ç»å„ç§è¯„ä¼°æŒ‡æ ‡çš„è®¡ç®—åŸç†
- **README.md**ï¼šé¡¹ç›®æ¦‚è¿°å’Œå¿«é€Ÿå¼€å§‹æŒ‡å—
